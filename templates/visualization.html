{% extends 'base.html' %}

{% block title %}{{ algorithm.name }} - AlgoViz3D{% endblock %}

{% block content %}
<div class="visualization-page">
    <div class="visualization-header">
        <h1>{{ algorithm.name }}</h1>
        <div class="breadcrumb">
            <a href="/dashboard/">Dashboard</a> &gt; 
            <span>{{ algorithm.name }}</span>
        </div>
    </div>
    
    <div class="visualization-container">
        <!-- Main visualization area -->
        <div class="visualization-canvas" id="visualization-canvas">
            <!-- The 3D visualization will be rendered here -->
            
            <!-- Enhanced focused step description panel -->
            <div id="focused-step-description" class="focused-step-description">
                <div class="focus-title">Select an algorithm to begin</div>
                <div class="focus-detail">Use the controls below to step through the algorithm</div>
                <div class="focus-explanation">The visualization will highlight important elements at each step</div>
            </div>
        </div>
        
        <!-- Enhanced Controls Section -->
        <div class="visualization-controls">
            <!-- Playback controls on the left -->
            <div class="left-controls">
                <div class="playback-controls">
                    <button id="step-backward" class="control-btn" title="Step Backward (Left Arrow)">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 5V19L10 12L20 5Z" fill="currentColor"/></svg>
                    </button>
                    
                    <button id="play-pause" class="control-btn" title="Play/Pause (Space)">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5V19L19 12L8 5Z" fill="currentColor"/></svg>
                    </button>
                    
                    <button id="step-forward" class="control-btn" title="Step Forward (Right Arrow)">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 5V19L14 12L4 5Z" fill="currentColor"/></svg>
                    </button>
                    
                    <button id="reset" class="control-btn" title="Reset (R)">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.99988C16.9706 2.99988 21 7.02931 21 11.9999C21 16.9704 16.9706 20.9999 12 20.9999C7.02944 20.9999 3 16.9704 3 11.9999C3 9.17261 4.30367 6.64978 6.34267 4.99988" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 4.49988H7V8.49988" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                    
                    <div class="speed-control">
                        <label for="animation-speed">Speed:</label>
                        <input type="range" id="animation-speed" min="1" max="10" value="5">
                        <span id="speed-display">5x</span>
                    </div>
                </div>
                
                <div class="step-info-panel">
                    <div id="step-counter" class="step-counter">Step 0 of 0</div>
                    <div id="step-description" class="step-description">Initial state</div>
                </div>
                
                <div class="view-controls">
                    <button id="camera-reset" class="control-btn" title="Reset Camera (C)">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                    
                    <button id="toggle-2d-3d" class="control-btn" title="Toggle 2D/3D View (V)">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3L20 7.5V16.5L12 21L4 16.5V7.5L12 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12L20 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12L4 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                </div>
            </div>
            
            <!-- Visualization options on the right -->
            <div class="right-controls">
                <div class="algorithm-options">
                    <!-- Focus Mode Toggle will be inserted here by JS -->
                    <div class="option-card">
                        <div class="option-title">Enhanced Focus Mode</div>
                        <div class="focus-toggle-wrapper">
                            <label class="toggle">
                                <input type="checkbox" id="focus-mode-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">Highlight Key Elements</span>
                        </div>
                    </div>
                    
                    <div class="option-card">
                        <div class="option-title">Shape Options</div>
                        <div id="shape-selector" class="shape-selector">
                            <!-- Shape options will be dynamically added here -->
                        </div>
                    </div>
                    
                    <div class="option-card">
                        <div class="option-title">Color Theme</div>
                        <div id="theme-selector" class="visualization-theme">
                            <!-- Theme options will be dynamically added here -->
                        </div>
                    </div>
                    
                    <div class="option-card">
                        <div class="option-title">Input Data</div>
                        <div class="input-field">
                            <label for="input-size">Size:</label>
                            <input type="range" id="input-size" min="5" max="20" value="10">
                            <span id="size-value">10</span>
                        </div>
                        
                        <div class="input-buttons">
                            <button id="generate-random" class="btn btn-secondary btn-small">Random</button>
                            <button id="generate-nearly-sorted" class="btn btn-secondary btn-small">Nearly Sorted</button>
                            <button id="generate-reversed" class="btn btn-secondary btn-small">Reversed</button>
                        </div>
                    </div>
                    
                    <div class="option-card">
                        <div class="option-title">Custom Input</div>
                        <div class="input-field-wrapper">
                            <input type="text" id="custom-input-data" class="input-field" placeholder="e.g. 3,1,4,1,5,9,2,6">
                            <button id="apply-custom" class="btn btn-primary btn-small">Apply</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Algorithm information -->
        <div class="algorithm-info-panel">
            <div class="panel-section">
                <h3>Algorithm Info</h3>
                <div class="info-content">
                    <p>{{ algorithm.description }}</p>
                    
                    <div class="complexity-info">
                        <div class="complexity-item">
                            <span class="complexity-label">Time Complexity:</span>
                            <span class="complexity-value">{{ algorithm.time_complexity }}</span>
                        </div>
                        <div class="complexity-item">
                            <span class="complexity-label">Space Complexity:</span>
                            <span class="complexity-value">{{ algorithm.space_complexity }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                <h3>Algorithm Code</h3>
                <div class="code-block">
                    <pre><code id="algorithm-code">{{ algorithm.code_implementation }}</code></pre>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // Pass algorithm data to JavaScript
    const algorithmData = {
        id: {{ algorithm.id }},
        name: "{{ algorithm.name }}",
        category: "{{ algorithm.category }}"
    };
</script>
<script src="/static/js/algorithm-visualization.js"></script>
{% endblock %}