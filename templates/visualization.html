{% extends 'base.html' %}

{% block title %}{{ algorithm.name }} - AlgoViz3D{% endblock %}

{% load webpack_loader %}

{% block extra_css %}
<style>
  /* Basic styles to ensure the visualization container dimensions are correct */
  .visualization-root {
    width: 100%;
    height: 700px;
    position: relative;
    margin-bottom: 2rem;
  }
  
  /* Loading state before React renders */
  .initial-loading {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #0a1929;
    color: white;
    font-family: 'Inter', -apple-system, sans-serif;
  }
  
  .initial-loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: #ffffff;
    animation: spin 1s ease-in-out infinite;
    margin-bottom: 1rem;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
{% endblock %}

{% block content %}
<div class="visualization-page">
  <div class="visualization-header">
    <h1>{{ algorithm.name }}</h1>
    <div class="breadcrumb">
      <a href="/dashboard/">Dashboard</a> &gt; 
      <span>{{ algorithm.name }}</span>
    </div>
  </div>
  
  <!-- React Visualization Root -->
  <div id="visualization-root" class="visualization-root">
    <div class="initial-loading">
      <div class="initial-loading-spinner"></div>
      <p>Loading visualization...</p>
    </div>
  </div>
  
  <!-- Algorithm Information -->
  <div class="algorithm-info-panel">
    <h2>About {{ algorithm.name }}</h2>
    <p>{{ algorithm.description }}</p>
    
    {% if algorithm.educational_notes %}
    <h3>Educational Notes</h3>
    <p>{{ algorithm.educational_notes }}</p>
    {% endif %}
    
    {% if algorithm.best_use_cases %}
    <h3>Best Use Cases</h3>
    <p>{{ algorithm.best_use_cases }}</p>
    {% endif %}
    
    {% if algorithm.limitations %}
    <h3>Limitations</h3>
    <p>{{ algorithm.limitations }}</p>
    {% endif %}
  </div>
  
  <!-- Include React bundle -->
  {% render_bundle 'main' %}
  
  <script>
    // Initialize the React component when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Convert Django algorithm model to JSON for React
      const algorithmData = {
        id: {{ algorithm.id }},
        name: "{{ algorithm.name|escapejs }}",
        description: "{{ algorithm.description|escapejs }}",
        timeComplexity: "{{ algorithm.time_complexity }}",
        spaceComplexity: "{{ algorithm.space_complexity }}",
        code_implementation: `{{ algorithm.code_implementation|escapejs }}`
      };
      
      // Initialize the React component
      window.initVisualizationPlayer('visualization-root', algorithmData);
    });
  </script>
</div>
{% endblock %}